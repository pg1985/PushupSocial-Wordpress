<?php
$options = get_option(PUSHUP_OPTIONS_NAME);
add_thickbox();
?>
 <script>
 $(document).ready(function($){

     $('#modal_link_create').hide();
     $('#modal_link_manage').hide();
     var base_url = 'https://api-staging.pushup.com/network/communities?';
     var wp_url = 'network_id=<?php echo $options[PUSHUP_OPTION_COMMUNITY] ?>';

     $.get(base_url + wp_url,
         function(data){
             if (data.length == 0) {

                 var email = '<?php echo get_option('admin_email')?>';

                 var site_url = '<?php echo get_option('siteurl') ?>';
                 var site_name = '<?php echo get_option('blogname') ?>';
                 var defaultQuery = "https://registration-dev.pushup.com/";
                 var queryString = "?email=" + email + "&url=" + site_url + "&site=" + site_name + "?width=800&height=550&TB_iframe=true";

                 $('#modal_link_create').attr("href", defaultQuery + queryString).show();

             }
             else {
                 setCommunityId(data['network_id']);
                 $('#modal_link_manage').show();
             }
         });
 });

 function setCommunityId(data) {
     $('#community_id').val(data + "");
 }

 </script>
<div class="wrap pushUpSocial">
    <form method="post" action="options.php">
        <?php settings_fields(PUSHUP_OPTIONS_GROUP); ?>
        <input type="hidden" name="<?php echo PUSHUP_OPTIONS_NAME ?>[<?php echo PUSHUP_OPTION_CONFIGURED ?>]"
               value="yes"/>
        <div class = "pushup-main-div">
            <div class = "pushup-logo">
                <img height ="50" src = "https://s3.amazonaws.com/pushup-cdn/pushup-white.svg">
            </div>
            <div class = "pushup-content">
                <div class = "pushup-form">
                    <a class = "pushup-element">
                        <div class = "pushup-title">
                            Activate Pushup Social
                        </div>
                        <a class = "pushup-button" id="modal_link_create" href="https://admin-staging.pushup.com/#TB_inline?width=800&height=550&TB_iframe=true">
                            Create your Community
                        </a>
                    </div>
                    <div class = "pushup-element pushup-grey">
                        <div class = "pushup-title">
                            Manually enter your Community ID
                        </div>
                        <div class = "pushup-text">
                            <input type = "text" class = "pushup-text-input" id="community_id" name="<?php echo PUSHUP_OPTIONS_NAME ?>[<?php echo PUSHUP_OPTION_COMMUNITY ?>]"
                                   value="<?php echo $options[PUSHUP_OPTION_COMMUNITY] ?>"/>
                        </div>
                        <a class = "pushup-button" id="modal_link_manage" href="https://admin-staging.pushup.com/#TB_inline?width=800&height=550&TB_iframe=true">
                            Use this ID
                        </a>
                    </div>
                </div>
                <div class = "pushup-computer">
                    <img height = "250" src = "http://cdn.pushup.com/pushup_computer.png">
                </div>
            </div>
        <div>
    </form>
</div>
